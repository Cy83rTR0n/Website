<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><style>:root{--accent-color:#FF4D4D}</style><title>HotPage: The Silent Browser Hijacker</title>
<meta name=description content="Unlocking the Secrets of Software: A Journey into Reverse Engineering"><meta name=keywords content='blog,gokarna,hugo,Malware Analysis Article'><meta property="og:url" content="https://Cy83rTR0n.github.io/website/posts/hotpage/"><meta property="og:type" content="website"><meta property="og:title" content="HotPage: The Silent Browser Hijacker"><meta property="og:description" content="Unlocking the Secrets of Software: A Journey into Reverse Engineering"><meta property="og:image" content="https://images.unsplash.com/photo-1544890225-2f3faec4cd60?auto=format&amp;fit=crop&amp;q=60&amp;w=500&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8aGFja2VyfGVufDB8fDB8fHww"><meta property="og:image:secure_url" content="https://images.unsplash.com/photo-1544890225-2f3faec4cd60?auto=format&amp;fit=crop&amp;q=60&amp;w=500&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8aGFja2VyfGVufDB8fDB8fHww"><meta name=twitter:card content="summary_large_image"><meta name=twitter:title content="HotPage: The Silent Browser Hijacker"><meta name=twitter:description content="Unlocking the Secrets of Software: A Journey into Reverse Engineering"><meta property="twitter:domain" content="https://Cy83rTR0n.github.io/website/posts/hotpage/"><meta property="twitter:url" content="https://Cy83rTR0n.github.io/website/posts/hotpage/"><meta name=twitter:image content="https://images.unsplash.com/photo-1544890225-2f3faec4cd60?auto=format&amp;fit=crop&amp;q=60&amp;w=500&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8aGFja2VyfGVufDB8fDB8fHww"><link rel=canonical href=https://Cy83rTR0n.github.io/website/posts/hotpage/><link rel=stylesheet type=text/css href=/website/css/normalize.min.css media=print><link rel=stylesheet type=text/css href=/website/css/main.min.css><link id=dark-theme rel=stylesheet href=/website/css/dark.min.css><script src=/website/js/bundle.min.fbe2f55794ed6ded1573152a130784ee5cb022de9676b19dd37d7559ee6f6fc6.js integrity="sha256-++L1V5Ttbe0VcxUqEweE7lywIt6WdrGd0311We5vb8Y="></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css integrity=sha384-Xi8rHCmBmhbuyyhbI88391ZKP2dmfnOl4rT9ZfRI7mLTdk1wblIUnrIq35nqwEvC crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js integrity=sha384-X/XCfMm41VSsqRNQgDerQczD69XqmjOOOwYQvr/uuC+j4OPoNhVgjdGFwhvN02Ja crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js integrity=sha384-+XBljXPPiv+OzfbB3cVmLHf4hdUFHlWNZN5spNQ7rmHTXpd7WvJum6fIACpNNfIR crossorigin=anonymous></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}],throwOnError:!1})})</script></head><body><script type=text/javascript>setThemeByUserPref()</script><header class=header><nav class=header-nav><div class=avatar><a href=https://Cy83rTR0n.github.io/website/><img src='https://images.unsplash.com/photo-1544890225-2f3faec4cd60?auto=format&amp;fit=crop&amp;q=60&amp;w=500&amp;ixlib=rb-4.0.3&amp;ixid=M3wxMjA3fDB8MHxzZWFyY2h8N3x8aGFja2VyfGVufDB8fDB8fHww' alt=avatar></a></div><div class=nav-title><a class=nav-brand href=https://Cy83rTR0n.github.io/website/>Reverse Engineering Blog</a></div><div class=nav-links><div class=nav-link><a href=https://Cy83rTR0n.github.io/website/><span data-feather=home></span> Home</a></div><div class=nav-link><a href=https://Cy83rTR0n.github.io/website/posts/><span data-feather=book></span> Posts</a></div><div class=nav-link><a href=https://Cy83rTR0n.github.io/website/projects/><span data-feather=code></span> Projects</a></div><div class=nav-link><a href=https://Cy83rTR0n.github.io/website/tags/><span data-feather=tag></span> Tags</a></div><div class=nav-link><a href=https://github.com/Cy83rTR0n><span data-feather=github></span></a></div><div class=nav-link><a href=https://www.reddit.com/user/Cy83rTr0n/><span data-feather=rss></span></a></div><span class=nav-icons-divider></span><div class="nav-link dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only></span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></div><div class=nav-link id=hamburger-menu-toggle><span id=hamburger-menu-toggle-screen-reader-target class=sr-only>menu</span>
<a><span data-feather=menu></span></a></div><ul class="nav-hamburger-list visibility-hidden"><li class=nav-item><a href=https://Cy83rTR0n.github.io/website/><span data-feather=home></span> Home</a></li><li class=nav-item><a href=https://Cy83rTR0n.github.io/website/posts/><span data-feather=book></span> Posts</a></li><li class=nav-item><a href=https://Cy83rTR0n.github.io/website/projects/><span data-feather=code></span> Projects</a></li><li class=nav-item><a href=https://Cy83rTR0n.github.io/website/tags/><span data-feather=tag></span> Tags</a></li><li class=nav-item><a href=https://github.com/Cy83rTR0n><span data-feather=github></span></a></li><li class=nav-item><a href=https://www.reddit.com/user/Cy83rTr0n/><span data-feather=rss></span></a></li><li class="nav-item dark-theme-toggle"><span id=dark-theme-toggle-screen-reader-target class=sr-only>theme</span>
<a><span id=theme-toggle-icon data-feather=moon></span></a></li></ul></div></nav></header><main id=content><div class="post container"><div class=post-header-section><h1>HotPage: The Silent Browser Hijacker</h1><small role=doc-subtitle></small><p class=post-date>July 18, 2024</p><ul class=post-tags><li class=post-tag><a href=https://Cy83rTR0n.github.io/website/tags/malware-analysis-article>Malware Analysis Article</a></li></ul></div><div class=post-content><p><h3 id=overiew>Overiew</h3><p>Recently there has been a new adware which goes by the name as &ldquo;HotPage&rdquo;. It comes in the disguise of giving protection from random advertisements and malicious websites, however in the background it drops a malicious signed driver which gives the attacker privileges to execute arbitary code on Windows hosts.</p><h3 id=infection-chain>Infection Chain</h3><p>Though the actual process by which the installer is shared is still unknown, however. The installer places the driver on the disk and initiates a service to execute it. The driver decrypts its configuration file, which includes a list of target Chromium-based browsers and libraries. If it detects any of these browser executables running or being loaded, the driver attempts to inject one of the specified libraries into the browser process. By hooking network-related Windows API functions, the injected library monitors the URLs being accessed and, under certain conditions, redirects the user to a different page using various methods</p><h3 id=notable-functionalities>Notable Functionalities</h3><h5 id=1-injector-driver>1. Injector Driver</h5><p>The injector driver’s main function is to inject libraries into browser applications, changing URLs or opening new tabs. It uses two threads from the Blackbone project to handle these requests and monitors newly created processes and executable images.</p><p>Upon initialization, the driver deletes its image from the disk and creates a device object \.\KNewTableBaseIo to manage I/O requests using specific IOCTLs. These control codes are protected by a regular expression, ensuring only legitimate updates.</p><h5 id=2-process-creation-notification-routine>2. Process creation notification routine</h5><p>The driver ensures that the homepage of a new browser instance is redirected to a specific URL from the hotPage configuration, even if this version of the installer doesn&rsquo;t use it.</p><p>A browser process is marked for redirection if:</p><ul><li>It&rsquo;s the first instance of the browser, not just a new tab.</li><li>The process’s file path matches a regular expression in the hotPage configuration.</li><li>The command line doesn&rsquo;t match any regular expression in the wlist.</li><li>If the command line includes its own file path, it must not match any in the ppwlist.
When the browser starts loading, a request to open a new tab is queued.</li></ul><h5 id=3-security-issues-and-privilege-escalation>3. Security issues and privilege escalation</h5><p>When initializing its device object, the driver does not specify any access control lists (ACLs) to restrict who can communicate with it. This oversight means that any process, regardless of its privilege level, can send I/O requests to the driver. The lack of ACLs exposes the driver to potential abuse, as it does not differentiate between legitimate and malicious requests.</p><p>Despite this, the driver employs a secondary layer of protection for certain I/O control codes. These control codes are designed to only accept requests from processes whose file paths match a specific regular expression pattern: <code>*ShieldNetWork\\Business\\DwBusiness_*</code>. This regular expression acts as a filter, ensuring that only processes located in the specified directory structure can execute these control codes.</p><p>The ESET researchers developed a proof-of-concept Python script that proved two scenarios where individuals could be allowed to escalate their privileges through the HotPage driver to run code as the NT AUTHORITY/Systems. One involved using arbitrary DLL injection in arbitrary processes, the other changing the command line of newly created processes.</p><h3 id=conclusion>Conclusion</h3><p>The analysis of this seemingly generic malware reveals the lengths to which adware developers will go to achieve their goals. They’ve not only crafted a sophisticated kernel component capable of manipulating processes with a variety of techniques but also navigated Microsoft&rsquo;s stringent requirements to obtain a code-signing certificate for their driver. This level of dedication highlights the ongoing challenge in cybersecurity: even the most unassuming threats can carry advanced capabilities, emphasizing the need for constant vigilance and robust security measures.</p><p>For further read please refer to the following:</p><ol><li><a href=https://thehackernews.com/2024/07/alert-hotpage-adware-disguised-as-ad.html>Alert: HotPage Adware Disguised as Ad Blocker Installs Malicious Kernel Driver</a></li><li><a href=https://www.welivesecurity.com/en/eset-research/hotpage-story-signed-vulnerable-ad-injecting-driver/>HotPage: Story of a signed, vulnerable, ad-injecting driver</a></li></ol></p></div><div class=prev-next></div><svg id="btt-button" class="arrow-logo" height="1em" viewBox="0 0 384 512" onclick="topFunction()" title="Go to top"><path d="M177 159.7l136 136c9.4 9.4 9.4 24.6.0 33.9l-22.6 22.6c-9.4 9.4-24.6 9.4-33.9.0L160 255.9l-96.4 96.4c-9.4 9.4-24.6 9.4-33.9.0L7 329.7c-9.4-9.4-9.4-24.6.0-33.9l136-136c9.4-9.5 24.6-9.5 34-.1z"/></svg>
<script>let mybutton=document.getElementById("btt-button");window.onscroll=function(){scrollFunction()};function scrollFunction(){document.body.scrollTop>20||document.documentElement.scrollTop>20?mybutton.style.display="block":mybutton.style.display="none"}function topFunction(){smoothScrollToTop()}function smoothScrollToTop(){const e=()=>{const t=document.documentElement.scrollTop||document.body.scrollTop;t>0&&(window.requestAnimationFrame(e),window.scrollTo(0,t-t/8))};e()}</script></div></main><footer class=footer><span>&copy; 2024 The Marauders</span>
<span>Made with &#10084;&#65039; using <a target=_blank href=https://github.com/526avijitgupta/gokarna>Gokarna</a></span></footer></body></html>